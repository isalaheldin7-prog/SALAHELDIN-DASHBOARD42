<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unified Trading Journal</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
--bg:#0b0f1a; --card:#131a2a; --border:#1f2a44;
--primary:#fff; --green:#22c55e; --red:#ef4444; --blue:#38bdf8;
--text:#e5e7eb; --muted:#94a3b8; --yellow:#facc15;
--purple:#a855f7; --cyan:#06b6d4;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:system-ui;padding:16px;}

/* MENU HAMBURGER */ 
.menu-btn{position:fixed;top:14px;left:14px;width:28px;height:20px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;z-index:3000;}
.menu-btn span{display:block;height:3px;background:var(--primary);border-radius:2px;}

/* SIDEBAR */ 
.sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background:var(--card);border-right:1px solid var(--border);padding:60px 20px 20px 20px;transition:.3s;z-index:2000;}
.sidebar.active{left:0;}
.sidebar a{display:block;color:var(--text);text-decoration:none;padding:14px 0;border-bottom:1px solid var(--border);font-size:14px;font-weight:500;}
.sidebar a:hover{color:var(--primary);}

/* CARDS & LAYOUT */ 
.section{max-width:1200px;margin:0 auto;padding-top:40px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;transition:0.3s;}
.card:hover{transform:scale(1.02);box-shadow:0 0 15px rgba(0,0,0,0.5);}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;}
input,select,button{width:100%;padding:10px;margin-top:6px;background:#0f1524;border:1px solid var(--border);color:#fff;border-radius:8px;}
button{background:var(--primary);border:none;font-weight:bold;cursor:pointer;transition:0.2s;}
button:hover{opacity:0.8;}
table{width:100%;border-collapse:collapse;font-size:12px;}
th,td{padding:10px;border-bottom:1px solid var(--border);text-align:center;}

/* CALENDAR */ 
.calendar-container{display:flex;flex-wrap:wrap;gap:20px;}
.calendar-main{flex:3;min-width:300px;}
.calendar-sidebar{flex:1;min-width:200px;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;}
.calendar-header{background:#1f2a44;padding:10px;text-align:center;font-weight:bold;font-size:12px;color:#94a3b8;text-transform:uppercase;}
.day-box{background:#131a2a;min-height:80px;padding:6px;position:relative;transition:0.2s;border:1px solid var(--border);}
.day-box:hover{background:#1f2a44;}
.day-num{font-weight:600;font-size:13px;display:block;}
.day-pnl{font-size:12px;font-weight:bold;display:block;margin-top:4px;}
.day-trades{font-size:10px;color:var(--muted);display:block;}
.pnl-pos{background:#dcfce7;color:#166534;}
.pnl-neg{background:#fee2e2;color:#991b1b;}
.week-card{background:#1f2a44;border:1px solid var(--border);padding:10px;border-radius:10px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;}
.week-label{font-size:12px;color:#94a3b8;}
.week-val{font-weight:bold;font-size:14px;}
.month-summary{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;color:#fff;}
</style>
</head>
<body>

<div class="menu-btn" id="menuBtn"><span></span><span></span><span></span></div>

<div class="sidebar" id="sidebar">
  <a href="#" data-tab="dash">üè† Dashboard</a>
  <a href="#" data-tab="addTrade">‚ûï Add Trade</a>
  <a href="#" data-tab="tradeLog">üìë Trade Log</a>
  <a href="#" data-tab="calendar">üìÖ Calendar</a>
  <a href="#" data-tab="charts">üìä Charts</a>
  <a href="#" data-tab="statistics">üìà Statistics</a>
  <a href="#" data-tab="settings">‚öôÔ∏è Settings</a>
</div>

<!-- DASHBOARD -->
<div id="dash" class="section">
  <div class="stats">
    <div class="card" style="background:#7c3aed"><small>Net PnL</small><b id="net">$0</b></div>
    <div class="card" style="background:#16a34a"><small>Profit</small><b id="profit">$0</b></div>
    <div class="card" style="background:#ef4444"><small>Loss</small><b id="loss">$0</b></div>
    <div class="card" style="background:#38bdf8"><small>Capital (Base)</small><b id="capital">$10000</b></div>
    <div class="card" style="background:#06b6d4"><small>Capital (Dynamic)</small><b id="dynamicCapital">$10000</b></div>
    <div class="card" style="background:#a855f7"><small>Total Trades</small><b id="count">0</b></div>
    <div class="card" style="background:#22c55e"><small>Win Rate</small><b id="winRate">0%</b></div>
  </div>
</div>

<!-- ADD TRADE -->
<div id="addTrade" class="section" style="display:none">
  <div class="card">
    <select id="market">
      <option>Forex</option><option>Crypto</option><option>Futures</option><option>Options</option><option>Bonds</option><option>Indices</option>
    </select>
    <input id="symbol" placeholder="Symbol">
    <input id="tradeLink" placeholder="Trade Link (URL)">
    <select id="session">
      <option>Asia AM</option><option>Asia PM</option><option>London AM</option><option>London PM</option><option>New York AM</option><option>New York PM</option>
    </select>
    <select id="type"><option value="buy">Buy</option><option value="sell">Sell</option></select>
    <input id="entry" type="number" placeholder="Entry">
    <input id="exit" type="number" placeholder="Exit">
    <input id="size" type="number" placeholder="Size">
    <input type="date" id="tradeDate">
    <input id="strategy" placeholder="Strategy">
    <select id="psychology">
      <option>Confident</option><option>Nervous</option><option>Neutral</option>
    </select>
    <button onclick="addTrade()">Save Trade</button>
  </div>
</div>

<!-- TRADE LOG -->
<div id="tradeLog" class="section" style="display:none">
  <div class="card" style="overflow-x:auto; max-height:70vh;">
    <table>
      <thead>
        <tr>
          <th>Market</th><th>Symbol</th><th>Link</th><th>Session</th><th>Type</th><th>Entry</th><th>Exit</th><th>Size</th><th>PnL</th><th>Date</th><th>Strategy</th><th>Psychology</th><th>Delete</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>
  </div>
</div>

<!-- CALENDAR -->
<div id="calendar" class="section" style="display:none">
  <div class="month-summary" id="calMonthSummary"></div>
  <div class="calendar-container">
    <div class="calendar-main">
      <div class="calendar-grid" id="calendarGrid">
        <div class="calendar-header">Sun</div><div class="calendar-header">Mon</div>
        <div class="calendar-header">Tue</div><div class="calendar-header">Wed</div>
        <div class="calendar-header">Thu</div><div class="calendar-header">Fri</div>
        <div class="calendar-header">Sat</div>
      </div>
    </div>
    <div class="calendar-sidebar" id="weeklyStats"></div>
  </div>
</div>

<!-- CHARTS -->
<div id="charts" class="section" style="display:none">
  <div class="card"><canvas id="chart"></canvas></div>
</div>

<!-- STATISTICS -->
<div id="statistics" class="section" style="display:none">
  <div class="card">
    <h3>Statistics</h3>
    <div><strong>Long:</strong> <span id="longCount">0</span></div>
    <div><strong>Short:</strong> <span id="shortCount">0</span></div>
    <div><strong>Time spent backtesting:</strong> <span id="backtestTime">0h 0m</span></div>
    <div><strong>Total data backtested:</strong> <span id="totalData">0 months</span></div>
    <div><strong>Avg. realized R-multiple:</strong> <span id="avgR">0</span></div>
    <div><strong>Avg hold time:</strong> <span id="avgHold">0h 0m</span></div>
    <div><strong>Max consecutive winning days:</strong> <span id="maxWinDays">0</span></div>
    <div><strong>Max consecutive losing days:</strong> <span id="maxLossDays">0</span></div>
  </div>
</div>

<!-- SETTINGS -->
<div id="settings" class="section" style="display:none">
  <div class="card">
    <label>Base Capital</label>
    <input id="setBaseCapital" type="number" value="10000">
    <button onclick="saveSettings()">Save Settings</button>
  </div>
</div>

<script>
// Sidebar toggle
const sidebar=document.getElementById("sidebar");
const menuBtn=document.getElementById("menuBtn");
menuBtn.onclick=()=>sidebar.classList.toggle("active");
document.querySelectorAll(".sidebar a").forEach(a=>{
  a.onclick=e=>{
    e.preventDefault();
    document.querySelectorAll(".section").forEach(s=>s.style.display="none");
    document.getElementById(a.dataset.tab).style.display="block";
    sidebar.classList.remove("active");
    if(a.dataset.tab==='calendar') renderCalendar();
    if(a.dataset.tab==='charts') updateChart();
    if(a.dataset.tab==='dash') renderDashboard();
    if(a.dataset.tab==='statistics') renderStatistics();
  }
});

// Trade Data
let trades=JSON.parse(localStorage.getItem("trades")||"[]");
let baseCapital=localStorage.baseCapital?+localStorage.baseCapital:10000;

// RENDER DASHBOARD & LOG
function renderDashboard(){
  const listEl=document.getElementById("list");
  const netEl=document.getElementById("net");
  const profitEl=document.getElementById("profit");
  const lossEl=document.getElementById("loss");
  const capitalEl=document.getElementById("capital");
  const dynamicCapitalEl=document.getElementById("dynamicCapital");
  const countEl=document.getElementById("count");
  const winRateEl=document.getElementById("winRate");

  let netPnL=0, profit=0, loss=0, dynamicCapital=baseCapital, winCount=0;

  listEl.innerHTML="";
  trades.forEach((t,i)=>{
    const pnl=t.type==='buy'?(t.exit-t.entry)*t.size:(t.entry-t.exit)*t.size;
    netPnL+=pnl; if(pnl>0) profit+=pnl; else loss+=pnl;
    dynamicCapital+=pnl;
    if(pnl>0) winCount++;

    listEl.innerHTML+=`<tr>
      <td>${t.market}</td><td>${t.symbol}</td><td><a href="${t.tradeLink||'#'}" target="_blank">Link</a></td>
      <td>${t.session}</td><td>${t.type}</td><td>${t.entry}</td><td>${t.exit}</td><td>${t.size}</td>
      <td>${pnl.toFixed(2)}</td><td>${t.date}</td><td>${t.strategy}</td><td>${t.psychology}</td>
      <td><button onclick="deleteTrade(${i})">üóëÔ∏è</button></td>
    </tr>`;
  });

  netEl.textContent=`$${netPnL.toFixed(2)}`;
  dynamicCapitalEl.textContent=`$${dynamicCapital.toFixed(2)}`;
  capitalEl.textContent=`$${baseCapital.toFixed(2)}`;
  profitEl.textContent=`$${profit.toFixed(2)}`;
  lossEl.textContent=`$${loss.toFixed(2)}`;
  countEl.textContent=trades.length;
  winRateEl.textContent=trades.length?Math.round((winCount/trades.length)*100)+'%':'0%';
  dynamicCapitalEl.style.color = dynamicCapital>=baseCapital?'#22c55e':'#ef4444';
  netEl.style.color = dynamicCapital>=baseCapital?'#22c55e':'#ef4444';
}

// ADD TRADE
function addTrade(){
  const trade={
    market:document.getElementById("market").value,
    symbol:document.getElementById("symbol").value,
    tradeLink:document.getElementById("tradeLink").value,
    session:document.getElementById("session").value,
    type:document.getElementById("type").value,
    entry:+document.getElementById("entry").value,
    exit:+document.getElementById("exit").value,
    size:+document.getElementById("size").value,
    date:document.getElementById("tradeDate").value||new Date().toISOString().split("T")[0],
    strategy:document.getElementById("strategy").value,
    psychology:document.getElementById("psychology").value,
    pnl:0
  };
  trade.pnl=trade.type==='buy'?(trade.exit-trade.entry)*trade.size:(trade.entry-trade.exit)*trade.size;
  trades.push(trade);
  localStorage.setItem("trades",JSON.stringify(trades));
  renderDashboard();
  ['market','symbol','tradeLink','session','type','entry','exit','size','tradeDate','strategy','psychology'].forEach(id=>document.getElementById(id).value='');
}

// DELETE TRADE
function deleteTrade(i){ trades.splice(i,1); localStorage.setItem("trades",JSON.stringify(trades)); renderDashboard(); }

// SETTINGS
function saveSettings(){ baseCapital=+document.getElementById("setBaseCapital").value; localStorage.baseCapital=baseCapital; renderDashboard(); }

// CALENDAR
function renderCalendar(){
  const grid=document.getElementById("calendarGrid");
  const monthDiv=document.getElementById("calMonthSummary");
  const weeklyDiv=document.getElementById("weeklyStats");
  grid.innerHTML="";
  weeklyDiv.innerHTML="";
  let now=new Date();
  const year=now.getFullYear(), month=now.getMonth();
  const firstDay=new Date(year,month,1).getDay();
  const lastDay=new Date(year,month+1,0).getDate();
  let monthPnL=0, weeks={};

  for(let d=0;d<firstDay;d++) grid.innerHTML+=`<div class="day-box"></div>`;

  for(let d=1;d<=lastDay;d++){
    const dateStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayTrades=trades.filter(t=>t.date===dateStr);
    const dayPnL=dayTrades.reduce((a,b)=>a+b.pnl,0);
    monthPnL+=dayPnL;
    const color=dayPnL>0?'#22c55e':dayPnL<0?'#ef4444':'#1f2a44';
    grid.innerHTML+=`<div class="day-box" style="background:${color}"><span class="day-num">${d}</span>${dayPnL!==0?`<span class="day-pnl">${dayPnL.toFixed(2)}</span>`:''}${dayTrades.length>0?`<span class="day-trades">${dayTrades.length} trades</span>`:''}</div>`;
    const week=Math.ceil((d+firstDay)/7); weeks[week]=(weeks[week]||0)+dayPnL;
  }

  monthDiv.innerHTML=`Monthly PnL: $${monthPnL.toFixed(2)}`;
  let html='';
  for(const w in weeks) html+=`<div class="week-card"><span class="week-label">Week ${w}</span><span class="week-val" style="color:${weeks[w]>=0?'#22c55e':'#ef4444'}">$${weeks[w].toFixed(2)}</span></div>`;
  weeklyDiv.innerHTML=html;
}

// CHART
let chart;
function updateChart(){
  const ctx=document.getElementById("chart").getContext("2d");
  if(chart) chart.destroy();
  chart=new Chart(ctx,{type:'bar',data:{labels:trades.map(t=>t.date),datasets:[{label:'PnL',data:trades.map
